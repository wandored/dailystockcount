{% extends 'report_layout.html' %}
{% block content %}
<!-- Table -->
<main role="main" class="container">
  <div class="row">
    <div class="col-lg-12">
      <div class="content-section">
        <legend class="border-bottom mb-1">{{ item_name }}</legend>
        <table class="table table-sm table-hover table-borderedless">
          <thead>
            <tr>
              <th scope="col">Date</th>
              <th scope="col">Begin</th>
              <th scope="col">Purchases</th>
              <th scope="col">Sales</th>
              <th scope="col">Waste</th>
              <th scope="col">Theory</th>
              <th scope="col">Count</th>
              <th scope="col">Variance</th>
            </tr>
          </thead>
          <tbody>
            {% for c, s, w, p in result %}
                <tr>
                  <td>{{ c.trans_date.strftime('%A-%m/%d') }}</td>
                  <td>{{ c.previous_total }}</td>
                  {% if p %}
                    <td> + {{ p }}</td>
                  {% else %}
                    <td> + 0</td>
                  {% endif %}
                  <td> - {{ s }}</td>
                  <td> - {{ w }}</td>
                  <td> = {{ c.theory }}</td>
                  <td> - {{ c.count_total }}</td>
                  <td> = {{ c.daily_variance }}</td>
                </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
    <!-- Boxes -->
    <div class="col-lg-4">
      <div class="content-section">
        <legend class="border-bottom mb-1">Weekly Total</legend>
        {% for v in total_variance %}
          {% if v.variance < 0 %}
            <div class="alert alert-danger" role="alert">
              <h5 class="alert-heading">Variance {{ v.variance }}</h5>
            </div>
          {% elif v.variance > 0 %}
            <div class="alert alert-warning" role="alert">
              <h5 class="alert-heading">Variance +{{ v.variance }}</h5>
            </div>
          {% elif v.variance == 0 %}
            <div class="alert alert-success" role="alert">
              <h5 class="alert-heading">Variance {{ v.variance }}</h5>
            </div>
          {% endif %}
        {% endfor %}
        {% for s in sales_wk %}
        {% if s.weekly_waste > 0 %}
            <div class="alert alert-danger" role="alert">
              <h5 class="alert-heading">Waste {{ s.weekly_waste }}</h5>
            </div>
          {% elif s.weekly_waste < 0 %}
            <div class="alert alert-warning" role="alert">
              <h5 class="alert-heading">Waste +{{ s.weekly_waste }}</h5>
            </div>
          {% elif s.weekly_waste == 0 %}
            <div class="alert alert-success" role="alert">
              <h5 class="alert-heading">Waste {{ s.weekly_waste }}</h5>
            </div>
          {% endif %}
        {% endfor %}
        {% for s in sales_wk %}
          <div class="alert alert-info" role="alert">
            <h5 class="alert-heading">Sales {{ s.weekly_sales }}</h5>
          </div>
        {% endfor %}
        {% for s in wkly_tot_purchase %}
          <div class="alert alert-info" role="alert">
            <h5 class="alert-heading">Purchases {{ s.purchases }}</h5>
          </div>
        {% endfor %}
      </div>
    </div>
    <div class="col-lg-4">
      <div class="content-section">
        <legend class="border-bottom mb-1">Weekly Average</legend>
        {% for v in wkly_variance %}
          {% if v.variance < 0 %}
            <div class="alert alert-danger" role="alert">
              <h5 class="alert-heading">Variance {{ "%.2f"|format(v.variance) }}</h5>
            </div>
          {% elif v.variance > 0 %}
            <div class="alert alert-warning" role="alert">
              <h5 class="alert-heading">Variance +{{ "%.2f"|format(v.variance) }}</h5>
            </div>
          {% elif v.variance == 0 %}
            <div class="alert alert-success" role="alert">
              <h5 class="alert-heading">Variance {{ "%.2f"|format(v.variance) }}</h5>
            </div>
          {% endif %}
        {% endfor %}
        {% for s in wkly_sales %}
        {% if s.waste > 0 %}
            <div class="alert alert-danger" role="alert">
              <h5 class="alert-heading">Waste {{ "%.2f"|format(s.waste) }}</h5>
            </div>
          {% elif s.waste < 0 %}
            <div class="alert alert-warning" role="alert">
              <h5 class="alert-heading">Waste +{{ "%.2f"|format(s.waste) }}</h5>
            </div>
          {% elif s.waste == 0 %}
            <div class="alert alert-success" role="alert">
              <h5 class="alert-heading">Waste {{ "%.2f"|format(s.waste) }}</h5>
            </div>
          {% endif %}
        {% endfor %}
        {% for s in wkly_sales %}
          <div class="alert alert-info" role="alert">
            <h5 class="alert-heading">Sales {{ "%.1f"|format(s.average) }}</h5>
          </div>
        {% endfor %}
        {% for c in wkly_on_hand %}
          <div class="alert alert-info" role="alert">
            <h5 class="alert-heading">On-Hand {{ "%.1f"|format(c.average) }}</h5>
          </div>
        {% endfor %}
      </div>
    </div>
    <div class="col-lg-4">
      <div class="content-section">
        <legend class="border-bottom mb-1">Monthly Average</legend>
        {% for v in mon_avg_variance %}
          {% if v.variance < 0 %}
            <div class="alert alert-danger" role="alert">
              <h5 class="alert-heading">Variance {{ "%.2f"|format(v.variance) }}</h5>
            </div>
          {% elif v.variance > 0 %}
            <div class="alert alert-warning" role="alert">
              <h5 class="alert-heading">Variance +{{ "%.2f"|format(v.variance) }}</h5>
            </div>
          {% elif v.variance == 0 %}
            <div class="alert alert-success" role="alert">
              <h5 class="alert-heading">Variance {{ "%.2f"|format(v.variance) }}</h5>
            </div>
          {% endif %}
        {% endfor %}
        {% for s in mon_avg_sales %}
        {% if s.waste > 0 %}
            <div class="alert alert-danger" role="alert">
              <h5 class="alert-heading">Waste {{ "%.2f"|format(s.waste) }}</h5>
            </div>
          {% elif s.waste < 0 %}
            <div class="alert alert-warning" role="alert">
              <h5 class="alert-heading">Waste +{{ "%.2f"|format(s.waste) }}</h5>
            </div>
          {% elif s.waste == 0 %}
            <div class="alert alert-success" role="alert">
              <h5 class="alert-heading">Waste {{ "%.2f"|format(s.waste) }}</h5>
            </div>
          {% endif %}
        {% endfor %}
        {% for s in mon_avg_sales %}
          <div class="alert alert-info" role="alert">
            <h5 class="alert-heading">Sales {{ "%.1f"|format(s.average) }}</h5>
          </div>
        {% endfor %}
        {% for c in mon_avg_on_hand %}
          <div class="alert alert-info" role="alert">
            <h5 class="alert-heading">On-Hand {{ "%.1f"|format(c.average) }}</h5>
          </div>
        {% endfor %}
      </div>
    </div>
  </div>
  <!-- Chart -->
  <div class="row">
    <div class="col-lg-12">
      <div class="content-section">
        <canvas id="barChart" width="900" height="400"></canvas>
        <script>
          var ctx = document.getElementById("barChart").getContext("2d");
          var barChart = new Chart(ctx, {
            type: "bar",
            data: {
              labels: {{ labels | safe }},
              datasets: [{
                  label: "Sales",
                data: {{ day_sales | safe }},
                  borderColor: "#c45850",
                  backgroundColor: "#c45850",
                  borderWidth:2,
                  type: 'line',
                  fill: false,
                }, {
                  label: "On-Hand",
                  data: {{ values | safe }},
                  borderColor: "#3e95cd",
                  backgroundColor: "#7bb6dd",
                  borderWidth:2,
                  fill: false,
                }] 
            },
            options: {
              title: {
                display: true,
                text: "{{ item_name }}",
              },
              responsive: true
            }
          });
        </script>
      </div>
    </div>
  </div>

</div>
{% endblock content %}
